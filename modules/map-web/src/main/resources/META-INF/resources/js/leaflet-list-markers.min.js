/* 
 * Leaflet List Markers v0.1.0 - 2017-11-26 
 * 
 * Copyright 2017 Stefano Cudini 
 * stefano.cudini@gmail.com 
 * http://labs.easyblog.it/ 
 * 
 * Licensed under the MIT license. 
 * 
 * Demo: 
 * http://labs.easyblog.it/maps/leaflet-list-markers/ 
 * 
 * Source: 
 * git@github.com:stefanocudini/leaflet-list-markers.git 
 * 
 */
(function(){L.Control.ListMarkers=L.Control.extend({includes:"1"===L.version[0]?L.Evented.prototype:L.Mixin.Events,options:{layer:!1,maxItems:20,collapsed:!1,label:"title",itemIcon:L.Icon.Default.imagePath+"/marker-icon.png",itemArrow:"&#10148;",maxZoom:9,position:"bottomleft"},initialize:function(a){L.Util.setOptions(this,a),this._container=null,this._list=null,this._layer=this.options.layer||new L.LayerGroup},onAdd:function(a){this._map=a;var b=this._container=L.DomUtil.create("div","list-markers");return this._list=L.DomUtil.create("ul","list-markers-ul",b),this._initToggle(),a.on("moveend",this._updateList,this),this._updateList(),b},onRemove:function(a){a.off("moveend",this._updateList,this),this._container=null,this._list=null},_createItem:function(a){var b=L.DomUtil.create("li","list-markers-li"),c=L.DomUtil.create("a","",b),d=this.options.itemIcon?'<img src="'+this.options.itemIcon+'" />':"",e=this;return c.href="#",L.DomEvent.disableClickPropagation(c).on(c,"click",L.DomEvent.stop,this).on(c,"click",function(b){this._moveTo(a.getLatLng())},this).on(c,"mouseover",function(b){e.fire("item-mouseover",{layer:a})},this).on(c,"mouseout",function(b){e.fire("item-mouseout",{layer:a})},this),a.options.hasOwnProperty(this.options.label)?c.innerHTML=d+"<span>"+a.options[this.options.label]+"</span> <b>"+this.options.itemArrow+"</b>":console.log("propertyName '"+this.options.label+"' not found in marker"),b},_updateList:function(){var a=this,b=0;this._list.innerHTML="",this._layer.eachLayer(function(c){c instanceof L.Marker&&a._map.getBounds().contains(c.getLatLng())&&++b<a.options.maxItems&&a._list.appendChild(a._createItem(c))})},_initToggle:function(){var a=this._container;if(a.setAttribute("aria-haspopup",!0),L.Browser.touch?L.DomEvent.on(a,"click",L.DomEvent.stopPropagation):L.DomEvent.disableClickPropagation(a),this.options.collapsed){this._collapse(),L.Browser.android||L.DomEvent.on(a,"mouseover",this._expand,this).on(a,"mouseout",this._collapse,this);var b=this._button=L.DomUtil.create("a","list-markers-toggle",a);b.href="#",b.title="List Markers",L.Browser.touch?L.DomEvent.on(b,"click",L.DomEvent.stop).on(b,"click",this._expand,this):L.DomEvent.on(b,"focus",this._expand,this),this._map.on("click",this._collapse,this)}},_expand:function(){this._container.className=this._container.className.replace(" list-markers-collapsed","")},_collapse:function(){L.DomUtil.addClass(this._container,"list-markers-collapsed")},_moveTo:function(a){this.options.maxZoom?this._map.setView(a,Math.min(this._map.getZoom(),this.options.maxZoom)):this._map.panTo(a)}}),L.control.listMarkers=function(a){return new L.Control.ListMarkers(a)},L.Map.addInitHook(function(){this.options.listMarkersControl&&(this.listMarkersControl=L.control.listMarkers(this.options.listMarkersControl),this.addControl(this.listMarkersControl))})}).call(this);